{% extends "base.html" %}

{% block content %}
<ul id="todo-list">
    {% for todo in todos %}
    <li>
        <div class="todo-item">
            <input type="checkbox" onchange="toggleComplete({{ todo.id }})" {% if todo.completed %}checked{% endif %}>
            <span {% if todo.completed %}style="text-decoration: line-through;" {% endif %}>{{ todo.title }}</span>
            <span class="delete" onclick="deleteTodo({{ todo.id }})">❌</span>
        </div>
        {% if todo.children %}
        <ul>
            {% for child in todo.children %}
            <li>
                <div class="todo-item">
                    <input type="checkbox" onchange="toggleComplete({{ child.id }})" {% if child.completed %}checked{%
                        endif %}>
                    <span {% if child.completed %}style="text-decoration: line-through;" {% endif %}>{{ child.title
                        }}</span>
                    <span class="delete" onclick="deleteTodo({{ child.id }})">❌</span>
                </div>
            </li>
            {% endfor %}
        </ul>
        {% endif %}
    </li>
    {% endfor %}
</ul>
<div class="add-todo">
    <form action="{{ url_for('add_todo') }}" method="post">
        <input type="text" name="title" placeholder="Add a new todo" required>
        <select name="parent_id">
            <option value="">No parent</option>
            {% for todo in todos %}
            <option value="{{ todo.id }}">{{ todo.title }}</option>
            {% endfor %}
        </select>
        <button type="submit">Add</button>
    </form>
</div>
{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const todoList = document.getElementById('todo-list');
        todoList.addEventListener('change', function (e) {
            if (e.target.type === 'checkbox') {
                const todoItem = e.target.closest('.todo-item');
                const todoText = todoItem.querySelector('span');
                if (e.target.checked) {
                    todoText.style.textDecoration = 'line-through';
                } else {
                    todoText.style.textDecoration = 'none';
                }
            }
        });
    });
</script>
{% endblock %}